<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your Dashboard | iAscendAi</title>

  <script type="module">
    import { CONFIG } from "./config.js";
    window.CONFIG = CONFIG;
  </script>

  <style>
    body {
      background: radial-gradient(circle at top, #0f172a, #020617 40%, #000814);
      color: #e5e7eb;
      font-family: Inter, sans-serif;
      padding: 26px;
      min-height: 100vh;
    }

    .logout {
      position: absolute;
      right: 20px;
      top: 20px;
      padding: 10px 18px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.25);
      background: rgba(255,255,255,0.08);
      cursor: pointer;
      font-size: 0.9rem;
      transition: 0.2s;
    }

    .logout:hover {
      background: rgba(255,255,255,0.18);
    }

    h1 {
      margin-bottom: 22px;
      font-size: 1.9rem;
      background: linear-gradient(120deg, #fed103, #4ade80);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .card {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.15);
      padding: 22px;
      border-radius: 16px;
      margin-bottom: 26px;
    }

    .label {
      font-size: 0.75rem;
      opacity: 0.9;
      margin-top: 8px;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }

    .value {
      font-size: 1rem;
      margin-bottom: 6px;
      margin-top: 3px;
      font-weight: 600;
      color: #fff;
    }

    #loading {
      margin-top: 28px;
      font-size: 1rem;
      opacity: 0.8;
    }

  </style>
</head>

<body>

  <button class="logout" id="logoutBtn">Logout</button>

  <h1>Your Dashboard</h1>

  <div id="loading">Loading your verified identity…</div>
  <div id="content" style="display:none;"></div>

  <script type="module">
    import { CONFIG } from "./config.js";
    const BACKEND_URL = CONFIG.BACKEND_URL;

    document.getElementById("logoutBtn").onclick = () => {
      localStorage.clear();
      window.location.href = "iascendai-login.html";
    };

    async function loadDashboard() {
      const username = localStorage.getItem("username");
      const email    = localStorage.getItem("email");

      // If no identity, redirect to login
      if (!username && !email) {
        window.location.href = "iascendai-login.html";
        return;
      }

      try {
        const res = await fetch(`${BACKEND_URL}/lookup-identity`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ identifier: username || email })
        });

        const data = await res.json();

        if (!res.ok || !data.user) {
          document.getElementById("loading").textContent =
            "Identity not found. Please login again.";
          return;
        }

        const user = data.user;

        // Hide loading
        document.getElementById("loading").style.display = "none";

        // Show dashboard
        const content = document.getElementById("content");
        content.style.display = "block";

        content.innerHTML = `
          <div class="card">
            <div class="label">SoulMarkⓈ</div>
            <div class="value">${user.soulmark || "—"}</div>

            <div class="label">Username</div>
            <div class="value">${user.username}@iascendai</div>

            <div class="label">Name</div>
            <div class="value">${user.name}</div>

            <div class="label">Email</div>
            <div class="value">${user.email}</div>

            <div class="label">Donation Amount</div>
            <div class="value">$${Number(user.donationAmount || 0).toFixed(2)}</div>

            <div class="label">Display Mode</div>
            <div class="value">${user.displayIdentity}</div>

            <div class="label">Show Amount</div>
            <div class="value">${user.showDonationAmount ? "Yes" : "No"}</div>
          </div>
        `;
      } catch (err) {
        document.getElementById("loading").textContent =
          "Error loading dashboard. Try again.";
      }
    }

    loadDashboard();
  </script>
</body>
</html>