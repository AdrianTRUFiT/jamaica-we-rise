<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>iAscendAi Dashboard | Jamaica We Rise</title>
  <script type="module">
    import { CONFIG } from "./config.js";
    window.CONFIG = CONFIG;
  </script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{
      --jamaica-green:#009b3a;
      --jamaica-gold:#fed100;
      --jamaica-black:#000;
      --glass-bg:rgba(255,255,255,0.1);
      --glass-border:rgba(255,255,255,0.2);
      --text-light:#fff;
      --accent-blue:#1e90ff
    }
    body{
      font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif;
      background:linear-gradient(135deg,#0a0a0a 0%,#1a1a1a 50%,#0f0f0f 100%);
      min-height:100vh;color:var(--text-light);padding:20px
    }
    .container{max-width:1200px;margin:0 auto}
    .header{
      text-align:center;margin-bottom:40px;padding:30px;
      background:var(--glass-bg);backdrop-filter:blur(10px);
      border-radius:20px;border:1px solid var(--glass-border)
    }
    .header h1{
      font-size:2.5em;margin-bottom:10px;
      background:linear-gradient(90deg,var(--jamaica-gold),#ffe55c);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent
    }
    .tabs{display:flex;justify-content:center;gap:10px;margin-bottom:30px;flex-wrap:wrap}
    .tab{
      padding:15px 25px;background:var(--glass-bg);border:2px solid var(--glass-border);
      border-radius:15px;cursor:pointer;transition:all .3s ease;font-size:1.1em;
      color:var(--text-light);display:flex;align-items:center;gap:8px
    }
    .tab.active{background:var(--jamaica-gold);color:var(--jamaica-black);font-weight:bold}
    .content{
      background:var(--glass-bg);border:1px solid var(--glass-border);
      border-radius:20px;padding:40px;min-height:500px
    }
    .tab-content{display:none;animation:fadeIn .4s ease}
    .tab-content.active{display:block}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .soulmark-display{background:rgba(0,0,0,.3);padding:30px;border-radius:15px;margin-bottom:30px;border:2px solid var(--jamaica-gold)}
    .soulmark-hash{font-family:"Courier New",monospace;font-size:1.2em;word-break:break-all;color:var(--jamaica-gold);margin:15px 0;padding:15px;background:rgba(0,0,0,.4);border-radius:10px}
    .identity-info{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-top:20px}
    .info-card{background:rgba(0,0,0,.2);padding:20px;border-radius:10px;border-left:4px solid var(--jamaica-gold)}
    .info-card label{font-size:.9em;opacity:.8;display:block;margin-bottom:5px}
    .info-card value{font-size:1.2em;font-weight:bold}
    .donation-list{display:flex;flex-direction:column;gap:20px}
    .donation-item{background:rgba(0,0,0,.3);padding:25px;border-radius:15px;border-left:5px solid var(--jamaica-gold)}
    .donation-amount{font-size:2em;color:var(--jamaica-gold);font-weight:bold}
    .status-badge{display:inline-block;padding:5px 15px;border-radius:20px;font-size:.9em;font-weight:bold;background:var(--jamaica-green);color:white}
    .nav-links{
      margin-top:40px;text-align:center
    }
    .nav-links a{
      display:inline-block;margin:10px 12px;padding:14px 22px;
      border-radius:30px;background:linear-gradient(135deg,var(--jamaica-gold),#ffe55c);
      color:var(--jamaica-black);font-weight:700;text-decoration:none;transition:.3s ease
    }
    .nav-links a:hover{transform:translateY(-3px);box-shadow:0 0 15px rgba(254,209,0,0.4)}
    @media(max-width:768px){.header h1{font-size:1.8em}.tab{padding:10px 15px;font-size:.9em}.content{padding:20px}}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ‡¯ğŸ‡² iAscendAi Dashboard</h1>
      <p class="tagline">Your Verified Presence in Jamaica We Rise</p>
    </div>

    <div class="tabs">
      <div class="tab active" data-tab="soulmark">ğŸ’  My SoulMarkâ“ˆ</div>
      <div class="tab" data-tab="soulaid">ğŸ’› My SoulAidâ“ˆ</div>
      <div class="tab" data-tab="tracker">ğŸŒ SoulTrackerâ“ˆ</div>
      <div class="tab" data-tab="updates">âœ‰ï¸ Updates</div>
      <div class="tab" data-tab="settings">âš™ï¸ Settings</div>
    </div>

    <div class="content">
      <div class="tab-content active" id="soulmark">
        <h2>ğŸ’  Your SoulMarkâ“ˆ Identity</h2>
        <div class="soulmark-display">
          <p><strong>Status:</strong> <span class="status-badge">âœ“ VERIFIED</span></p>
          <p style="margin-top:15px;"><strong>SoulMarkâ“ˆ Hash:</strong></p>
          <div class="soulmark-hash" id="soulmark-hash">Loading...</div>
          <p style="font-size:.9em;opacity:.8;margin-top:10px;">Your verified cryptographic signature inside Jamaica We Rise.</p>
        </div>

        <div class="identity-info">
          <div class="info-card"><label>Email</label><value id="user-email">Loading...</value></div>
          <div class="info-card"><label>Username</label><value id="user-username">Loading...</value></div>
          <div class="info-card"><label>Type</label><value id="identity-type">Supporterâ“ˆ</value></div>
          <div class="info-card"><label>Registered</label><value id="reg-date">Loading...</value></div>
        </div>

        <div class="nav-links">
          <a href="tracker.html">ğŸŒ Open SoulTrackerâ“ˆ</a>
          <a href="soulregistry.html">ğŸ“œ View SoulRegistryâ“ˆ</a>
          <a href="verify.html">ğŸ” Verify SoulMarkâ“ˆ</a>
        </div>
      </div>

      <div class="tab-content" id="soulaid">
        <h2>ğŸ’› Your SoulAidâ“ˆ Contributions</h2>
        <div id="donations-container" class="loading">
          <div class="spinner"></div>
          <p>Loading contribution history...</p>
        </div>
      </div>

      <div class="tab-content" id="tracker">
        <h2>ğŸŒ Live SoulTrackerâ“ˆ</h2>
        <div class="tracker-container">
          <div class="metrics">
            <div class="metric-card"><div class="metric-label">Total Supportersâ“ˆ</div><span class="metric-value" id="total-supporters">0</span></div>
            <div class="metric-card"><div class="metric-label">SoulAidâ“ˆ Delivered</div><span class="metric-value" id="total-soulaid">$0</span></div>
            <div class="metric-card"><div class="metric-label">Verified Survivorsâ“ˆ</div><span class="metric-value" id="total-survivors">0</span></div>
            <div class="metric-card"><div class="metric-label">Active Parishes</div><span class="metric-value" id="active-parishes">0</span></div>
          </div>
        </div>
      </div>

      <div class="tab-content" id="updates">
        <h2>âœ‰ï¸ Field Updates</h2>
        <div class="update-item">
          <div class="update-header"><div class="update-title">Welcome to Jamaica We Rise</div><div class="update-date">Nov 11 2025</div></div>
          <div class="update-body">Your SoulMarkâ“ˆ has been verified and added to the living registry.</div>
        </div>
      </div>

      <div class="tab-content" id="settings">
        <h2>âš™ï¸ Settings & Preferences</h2>
        <p style="opacity:.8;line-height:1.6;">Your SoulMarkâ“ˆ identity is stored locally and secured within the public SoulRegistryâ“ˆ.</p>
      </div>
    </div>
  </div>

  <script type="module">
    import { CONFIG } from "./config.js";
    const BACKEND_URL = CONFIG.BACKEND_URL;

    let userData={soulmark:"",email:"",username:"",role:"supporter",donations:[]};

    document.addEventListener("DOMContentLoaded",async()=>{
      const params=new URLSearchParams(window.location.search);
      userData.soulmark=params.get("soulmark")||localStorage.getItem("soulmark")||"";
      userData.email=params.get("email")||localStorage.getItem("email")||"";
      userData.username=params.get("username")||localStorage.getItem("username")||"";
      userData.role=params.get("role")||"supporter";

      if(userData.soulmark)localStorage.setItem("soulmark",userData.soulmark);
      if(userData.email)localStorage.setItem("email",userData.email);
      if(userData.username)localStorage.setItem("username",userData.username);

      document.getElementById("soulmark-hash").textContent=userData.soulmark||"Not available";
      document.getElementById("user-email").textContent=userData.email||"Not registered";
      document.getElementById("user-username").textContent=userData.username?`${userData.username}@iascendai`:"Anonymous";
      document.getElementById("identity-type").textContent=userData.role==="survivor"?"Survivorâ“ˆ":"Supporterâ“ˆ";

      await loadUserData();
      initTabs();
      loadTrackerMetrics();
    });

    async function loadUserData(){
      try{
        const res=await fetch(`${BACKEND_URL}/registry`,{cache:"no-store"});
        const registry=await res.json();
        const related=registry.filter(e=>
          (userData.email&&(e.email||"").toLowerCase()===userData.email.toLowerCase())||
          (userData.username&&(e.username||"").toLowerCase()===userData.username.toLowerCase())||
          (userData.soulmark&&(e.soulmark||e.soulMark||"").toUpperCase()===userData.soulmark.toUpperCase())
        );
        userData.donations=related.filter(e=>typeof e.amount==="number");
        renderDonations();
      }catch(err){console.error("Registry load failed:",err);}
    }

    function renderDonations(){
      const c=document.getElementById("donations-container");
      if(!userData.donations.length){
        c.innerHTML=`<div class="empty-state"><div class="empty-state-icon">ğŸ’›</div><p>No SoulAidâ“ˆ contributions yet.</p></div>`;
        return;
      }
      c.className="donation-list";
      c.innerHTML=userData.donations.map(d=>`
        <div class="donation-item">
          <div class="donation-header">
            <div class="donation-amount">$${d.amount}</div>
            <div class="donation-date">${new Date(d.date||d.timestamp||Date.now()).toLocaleDateString()}</div>
          </div>
          <div><strong>Transaction ID:</strong> ${d.transactionId||d.sessionId||"Pending"}</div>
          <div class="donation-impact">ğŸŒ SoulAidâ“ˆ coordinated for verified survivors.</div>
        </div>`).join("");
    }

    function initTabs(){
      const tabs=document.querySelectorAll(".tab"),contents=document.querySelectorAll(".tab-content");
      tabs.forEach(t=>{
        t.addEventListener("click",()=>{
          tabs.forEach(tab=>tab.classList.remove("active"));
          contents.forEach(c=>c.classList.remove("active"));
          t.classList.add("active");
          document.getElementById(t.dataset.tab).classList.add("active");
        });
      });
    }

    async function loadTrackerMetrics(){
      try{
        const res=await fetch(`${BACKEND_URL}/registry`,{cache:"no-store"});
        const registry=await res.json();
        const supporters=new Set();let total=0,survivors=0;
        registry.forEach(e=>{
          if(e.email)supporters.add(e.email);
          if(typeof e.amount==="number")total+=e.amount;
          if(e.role==="survivor")survivors++;
        });
        document.getElementById("total-supporters").textContent=supporters.size;
        document.getElementById("total-soulaid").textContent=`$${total.toLocaleString()}`;
        document.getElementById("total-survivors").textContent=survivors;
        document.getElementById("active-parishes").textContent=3;
      }catch(err){console.error("Tracker load failed:",err);}
    }
  </script>
</body>
</html>
