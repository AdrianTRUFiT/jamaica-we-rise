<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your Dashboard | iAscendAi</title>

  <script type="module">
    import { CONFIG } from "./config.js";
    window.CONFIG = CONFIG;
  </script>

  <style>
    body { background:#020617; color:white; font-family:Inter,sans-serif; padding:24px; }
    h1 { margin-bottom:16px; background:linear-gradient(120deg,#fed103,#4ade80); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
    .logout { position:absolute; right:18px; top:18px; padding:8px 14px; border:1px solid rgba(255,255,255,0.3); background:rgba(255,255,255,0.08); border-radius:999px; cursor:pointer; }
    .card { background:rgba(255,255,255,0.06); padding:20px; border-radius:14px; margin-bottom:22px; }
  </style>
</head>

<body>

  <button class="logout" id="logoutBtn">Logout</button>

  <h1>Your Dashboard</h1>

  <div id="loading">Loading your verified identity…</div>
  <div id="content" style="display:none;"></div>

  <script type="module">
    import { CONFIG } from "./config.js";
    const BACKEND_URL = CONFIG.BACKEND_URL;

    document.getElementById("logoutBtn").onclick = () => {
      localStorage.clear();
      window.location.href = "iascendai-login.html";
    };

    async function loadDashboard() {
      const username = localStorage.getItem("username");
      const email    = localStorage.getItem("email");

      if (!username && !email) {
        window.location.href = "iascendai-login.html";
        return;
      }

      const res = await fetch(`${BACKEND_URL}/lookup-identity`, {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ identifier: username || email })
      });

      const data = await res.json();

      if (!res.ok) {
        document.getElementById("loading").textContent = "Identity not found.";
        return;
      }

      const user = data.user;

      document.getElementById("loading").style.display="none";

      const content = document.getElementById("content");
      content.style.display = "block";

      content.innerHTML = `
        <div class="card">
          <h2>SoulMarkⓈ</h2>
          <p>${user.soulmark}</p>

          <h2>Username</h2>
          <p>${user.username}@iascendai</p>

          <h2>Name</h2>
          <p>${user.name}</p>
        </div>
      `;
    }

    loadDashboard();
  </script>
</body>
</html>