<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Login | iAscendAi Identity Engine</title>

<script type="module">
import { CONFIG } from "./config.js";
window.CONFIG = CONFIG;
</script>

<style>
/* -------- GLOBAL RESET -------- */
* { margin:0; padding:0; box-sizing:border-box; }

:root {
  --bg-dark:#020617;
  --accent:#f4a349;
  --accent-soft:#ffb76b;
  --text:#e5e7eb;
  --text-soft:#9ca3af;
  --input-bg:rgba(255,255,255,0.06);
  --error:#f97373;
  --success:#4ade80;
}

/* -------- PAGE -------- */
body {
  font-family:-apple-system,BlinkMacSystemFont,"Inter",Roboto,sans-serif;
  background:radial-gradient(circle at top,#1e2638 0%,#020617 45%,#000 100%);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:24px;
  color:var(--text);
}

/* -------- CARD -------- */
.container {
  width:100%;
  max-width:440px;
  background:rgba(15,23,42,0.92);
  border-radius:22px;
  border:1px solid rgba(255,255,255,0.08);
  padding:32px 26px 28px;
  box-shadow:0 26px 65px rgba(0,0,0,0.9);
}

.logo-img {
  width:140px;
  display:block;
  margin:0 auto 18px auto;
}

.title {
  text-align:center;
  font-size:1.6rem;
  font-weight:800;
  color:var(--accent);
}

.subtitle {
  text-align:center;
  font-size:0.92rem;
  color:var(--text-soft);
  margin-bottom:24px;
}

/* -------- FORM -------- */
.form-group { margin-bottom:18px; }

label {
  font-size:0.9rem;
  font-weight:600;
  margin-bottom:6px;
  display:block;
}

input {
  width:100%;
  padding:13px 14px;
  border-radius:12px;
  background:var(--input-bg);
  border:1px solid rgba(255,255,255,0.14);
  font-size:0.95rem;
  color:var(--text);
}

input:focus {
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 2px rgba(244,163,73,0.4);
}

.status {
  font-size:0.82rem;
  min-height:18px;
  margin-top:-6px;
  margin-bottom:12px;
}

.status.ok { color:var(--success); }
.status.bad { color:var(--error); }

/* -------- BUTTON -------- */
.submit-btn {
  width:100%;
  padding:14px;
  border-radius:999px;
  border:none;
  font-size:1rem;
  font-weight:750;
  cursor:pointer;
  background:linear-gradient(135deg,var(--accent),var(--accent-soft));
  color:#04101f;
  box-shadow:0 18px 44px rgba(0,0,0,0.7);
}

.submit-btn:hover:not(:disabled) {
  transform:translateY(-2px);
  box-shadow:0 24px 55px rgba(0,0,0,1);
}

.submit-btn:disabled { opacity:0.5; }

/* -------- FOOTER LINKS -------- */
.footer-links {
  text-align:center;
  margin-top:20px;
  font-size:0.82rem;
  color:var(--text-soft);
}

.footer-links a {
  color:var(--accent-soft);
  font-weight:600;
  text-decoration:none;
}
</style>
</head>

<body>
<div class="container">

  <img src="assets/iAscendAi-logo-small.png" class="logo-img" />

  <div class="title">Login</div>
  <div class="subtitle">Sign in to continue.</div>

  <form id="loginForm">
    <div class="form-group">
      <label for="identifier">Username or Email</label>
      <input id="identifier" placeholder="yourname or you@example.com" />
    </div>

    <div class="form-group">
      <label for="accessKey">Access Key</label>
      <input id="accessKey" type="password" placeholder="Enter your Access Key" />
    </div>

    <div id="status" class="status"></div>

    <button id="submitBtn" class="submit-btn" type="submit">
      Log In
    </button>
  </form>

  <div class="footer-links">
    <a href="iascendai-verify.html">Forgot Identity?</a> &bull;
    <a href="iascendai-register.html">Create Identity</a>
  </div>

</div>

<script type="module">
import { CONFIG } from "./config.js";
const BACKEND_URL = CONFIG.BACKEND_URL;

const idInput = document.getElementById("identifier");
const keyInput = document.getElementById("accessKey");
const statusEl = document.getElementById("status");
const submitBtn = document.getElementById("submitBtn");

document.getElementById("loginForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const identifier = idInput.value.trim().toLowerCase();
  const accessKey = keyInput.value.trim();

  if (!identifier || !accessKey) {
    statusEl.textContent = "Please enter your username/email and access key.";
    statusEl.className = "status bad";
    return;
  }

  submitBtn.disabled = true;
  submitBtn.textContent = "Authenticating…";

  try {
    // Look up identity via backend
    const res = await fetch(`${BACKEND_URL}/lookup-identity`, {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({ identifier })
    });

    const data = await res.json();

    if (!res.ok || !data.user) {
      statusEl.textContent = "Identity not found.";
      statusEl.className = "status bad";
      submitBtn.disabled = false;
      submitBtn.textContent = "Log In";
      return;
    }

    // Validate accessKey
    if (data.user.accessKey !== accessKey) {
      statusEl.textContent = "Incorrect Access Key.";
      statusEl.className = "status bad";
      submitBtn.disabled = false;
      submitBtn.textContent = "Log In";
      return;
    }

    // SUCCESS
    statusEl.textContent = "Identity Verified. Opening Dashboard…";
    statusEl.className = "status ok";

    localStorage.setItem("username", data.user.username);
    localStorage.setItem("email", data.user.email);
    localStorage.setItem("soulmark", data.user.soulmark);

    window.location.href = `iascendai-dashboard.html?username=${data.user.username}`;

  } catch (err) {
    console.error(err);
    statusEl.textContent = "Unable to verify identity.";
    statusEl.className = "status bad";
  }

  submitBtn.disabled = false;
  submitBtn.textContent = "Log In";
});
</script>

</body>
</html>