<!-- public/impact-dashboard.html -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>Impact Dashboard | Jamaica We Rise × iAscendAi</title>

<script type="module">
import { CONFIG } from "./config.js";
window.CONFIG = CONFIG;
</script>

<style>
body {
  margin:0;
  padding:0;
  font-family:-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", Roboto, sans-serif;
  background:linear-gradient(160deg,#031623 0%,#020c15 50%,#00060a 100%);
  color:#fff;
  min-height:100vh;
}

header {
  padding:20px;
  text-align:center;
  background:rgba(255,255,255,0.04);
  border-bottom:1px solid rgba(255,255,255,0.1);
  position:relative;
}

.logout-btn {
  position:absolute;
  right:20px;
  top:20px;
  padding:6px 14px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.2);
  background:rgba(255,255,255,0.1);
  color:#fff;
  font-size:0.8rem;
  cursor:pointer;
  backdrop-filter:blur(6px);
}

h1 {
  background:linear-gradient(135deg,#fed103,#05c85b);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  font-size:2.4rem;
  margin-bottom:4px;
}

p {
  color:rgba(255,255,255,0.75);
  margin:0;
  font-size:1rem;
}

.stats-board {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:22px;
  padding:30px;
  max-width:1200px;
  margin:0 auto;
}

.stat-box {
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.12);
  padding:24px;
  border-radius:16px;
  text-align:center;
  box-shadow:0 0 22px rgba(4, 132, 68, 0.2);
  transition:0.3s ease;
}

.stat-box:hover {
  transform:translateY(-3px);
  box-shadow:0 0 36px rgba(254,209,3,0.35);
}

.stat-label {
  color:rgba(255,255,255,0.7);
  font-size:0.95rem;
  margin-bottom:6px;
}

.stat-value {
  font-size:2.2rem;
  font-weight:700;
  color:#fed103;
}

.registry-list {
  max-width:900px;
  margin:40px auto;
  padding:0 20px;
}

.entry {
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.12);
  padding:20px;
  border-radius:14px;
  margin-bottom:16px;
  transition:0.2s;
}

.entry:hover {
  border-color:#fed103;
  background:rgba(255,255,255,0.08);
}

.entry h3 {
  margin:0 0 6px;
  font-size:1.2rem;
  color:#fed103;
}

.entry p {
  margin:3px 0;
  color:rgba(255,255,255,0.85);
  font-size:0.95rem;
}

footer {
  text-align:center;
  padding:30px;
  color:rgba(255,255,255,0.5);
  margin-top:40px;
}

footer a {
  color:#fed103;
  text-decoration:none;
}
</style>
</head>

<body>

<header>
  <button class="logout-btn" id="logoutBtn">Logout</button>
  <h1>Impact Dashboard</h1>
  <p>Live donations · Verified identities · SoulMarkⓈ anchored</p>
</header>

<section class="stats-board">
  <div class="stat-box">
    <div class="stat-label">Total Raised</div>
    <div class="stat-value" id="totalRaised">$0</div>
  </div>

  <div class="stat-box">
    <div class="stat-label">Total Donors</div>
    <div class="stat-value" id="totalDonors">0</div>
  </div>

  <div class="stat-box">
    <div class="stat-label">Verified Identities</div>
    <div class="stat-value" id="verifiedIdentities">0</div>
  </div>
</section>

<section class="registry-list" id="registryList">
  <h2 style="text-align:center; margin-bottom:20px;">Recent Activity</h2>
  <div id="entries"></div>
</section>

<footer>
  © 2025 Jamaica We Rise × iAscendAi • Authored Intelligence  
  <br />
  <a href="index.html">← Back to Donation Page</a>
</footer>

<script type="module">
import { CONFIG } from "./config.js";
const BACKEND_URL = CONFIG.BACKEND_URL;

document.getElementById("logoutBtn").onclick = () => {
  localStorage.clear();
  window.location.href = "iascendai-login.html";
};

async function loadImpact() {
  try {
    const res = await fetch(`${BACKEND_URL}/registry`, { cache: "no-store" });
    const data = await res.json();

    let totalRaised = 0;
    const donorEmails = new Set();
    const identityRecords = data.filter(r => r.type === "identity");
    const donations = data.filter(r => r.type === "donation");

    donations.forEach(d => {
      totalRaised += d.amount || 0;
      if (d.email) donorEmails.add(d.email);
    });

    document.getElementById("totalRaised").textContent =
      `$${totalRaised.toLocaleString()}`;
    document.getElementById("totalDonors").textContent = donorEmails.size;
    document.getElementById("verifiedIdentities").textContent =
      identityRecords.length;

    const entriesContainer = document.getElementById("entries");
    entriesContainer.innerHTML = "";

    const recent = [...donations]
      .sort((a, b) => new Date(b.timestamp || 0) - new Date(a.timestamp || 0))
      .slice(0, 25);

    recent.forEach(e => {
      const displayName =
        e.displayIdentity === "anonymous"
          ? "Anonymous"
          : e.displayIdentity === "real"
            ? (e.name || "Anonymous")
            : e.username
              ? `${e.username}@iascendai`
              : (e.name || e.email || "Anonymous");

      entriesContainer.innerHTML += `
        <div class="entry">
          <h3>${displayName}</h3>
          <p><strong>Amount:</strong> $${e.amount}</p>
          <p><strong>Email:</strong> ${e.email || "—"}</p>
          <p><strong>SoulMarkⓈ:</strong> ${e.soulmark}</p>
          <p><strong>Timestamp:</strong> ${new Date(e.timestamp).toLocaleString()}</p>
        </div>
      `;
    });

  } catch (err) {
    console.error("Load error:", err);
    document.getElementById("entries").innerHTML =
      "<p style='color:#f66;text-align:center;'>Unable to load activity.</p>";
  }
}

loadImpact();
</script>

</body>
</html>