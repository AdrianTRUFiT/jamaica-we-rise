<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Donation Successful | Jamaica We Rise × iAscendAi</title>

  <!-- Config -->
  <script type="module">
    import { CONFIG } from "./config.js";
    window.CONFIG = CONFIG;
  </script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg-deep:#020617;
      --glass:rgba(11,25,45,0.88);
      --border-soft:rgba(148,163,184,0.4);

      --gold:#fed103;
      --orange:#f4a349;
      --aqua:#b8edee;
      --teal:#22d3ee;

      --text-bright:#e5f2ff;
      --text-soft:#9ca3af;
    }

    body {
      font-family: Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
      min-height:100vh;
      background:radial-gradient(circle at top,#0f172a 0%,#020617 40%,#000814 90%);
      display:flex;
      justify-content:center;
      align-items:center;
      padding:20px;
      color:var(--text-bright);
    }

    .card {
      width:100%;
      max-width:620px;
      background:var(--glass);
      border-radius:24px;
      padding:32px;
      border:1px solid var(--border-soft);
      box-shadow:0 30px 80px rgba(0,0,0,0.7);
      animation:fadeIn .7s ease;
    }

    @keyframes fadeIn {
      from { opacity:0; transform:translateY(20px); }
      to   { opacity:1; transform:translateY(0); }
    }

    .title {
      text-align:center;
      font-size:1.9rem;
      font-weight:800;
      background:linear-gradient(120deg,var(--aqua),var(--gold));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      margin-bottom:10px;
    }

    .subtitle {
      text-align:center;
      color:var(--text-soft);
      margin-bottom:28px;
      font-size:.95rem;
    }

    .field-box { margin-bottom:20px; }

    .label {
      font-size:.75rem;
      letter-spacing:.14em;
      text-transform:uppercase;
      color:var(--text-soft);
      margin-bottom:6px;
    }

    .value-pill {
      padding:14px 18px;
      background:rgba(15,23,42,0.9);
      border:1px solid rgba(148,163,184,0.35);
      border-radius:14px;
      font-weight:600;
      font-size:1rem;
      color:var(--text-bright);
      word-break:break-word;
    }

    .btn {
      margin-top:28px;
      width:100%;
      padding:16px;
      border:none;
      border-radius:999px;
      background:linear-gradient(135deg,var(--orange),var(--gold));
      font-weight:800;
      color:#041423;
      font-size:1.05rem;
      cursor:pointer;
      transition:.2s ease;
      box-shadow:0 20px 45px rgba(0,0,0,.55);
    }

    .btn:hover {
      transform:translateY(-2px);
      box-shadow:0 25px 60px rgba(0,0,0,.75);
    }
  </style>
</head>

<body>
  <div class="card">
    <h1 class="title">Donation Successful</h1>
    <p class="subtitle">
      Thank you for supporting <strong>Jamaica We Rise</strong>.
      Securing your verified identity link now.
    </p>

    <div class="field-box">
      <div class="label">Amount</div>
      <div id="amountBox" class="value-pill">$—</div>
    </div>

    <div class="field-box">
      <div class="label">Email</div>
      <div id="emailBox" class="value-pill">Retrieving…</div>
    </div>

    <div class="field-box">
      <div class="label">SoulMarkⓈ Hash</div>
      <div id="soulBox" class="value-pill" style="font-size:0.87rem;">
        Generating…
      </div>
    </div>

    <button id="continueBtn" class="btn">
      Continue to Create Your Identity
    </button>
  </div>

  <script type="module">
    import { CONFIG } from "./config.js";
    const BACKEND_URL = CONFIG.BACKEND_URL;

    const params = new URLSearchParams(window.location.search);
    const sessionId = params.get("session_id");

    if (!sessionId) {
      document.getElementById("emailBox").textContent = "Missing session_id";
      document.getElementById("soulBox").textContent = "Cannot retrieve SoulMark";
    }

    async function fetchSession() {
      try {
        const res = await fetch(
          `${BACKEND_URL}/retrieve-session?session_id=${encodeURIComponent(sessionId)}`
        );
        const data = await res.json();

        const amount = data.amount || "";
        const email = data.email || "";
        const soulmark = data.soulmark ||
          ("SM-" + btoa(sessionId).slice(0, 12)); // fallback

        document.getElementById("amountBox").textContent =
          amount ? `$${Number(amount).toFixed(2)}` : "$—";

        document.getElementById("emailBox").textContent =
          email || "Not available";

        document.getElementById("soulBox").textContent = soulmark;

        // Save for registration autofill
        localStorage.setItem("donation_amount", amount);
        localStorage.setItem("donor_email", email);
        localStorage.setItem("donor_soulmark", soulmark);

      } catch (err) {
        document.getElementById("emailBox").textContent =
          "Error retrieving donation.";
        document.getElementById("soulBox").textContent = "Error generating SoulMark.";
      }
    }

    await fetchSession();

    document.getElementById("continueBtn").addEventListener("click", () => {
      const email = localStorage.getItem("donor_email") || "";
      const soulmark = localStorage.getItem("donor_soulmark") || "";
      const amount = localStorage.getItem("donation_amount") || "";

      window.location.href =
        `/iascendai-register.html?email=${encodeURIComponent(email)}&soulmark=${encodeURIComponent(soulmark)}&amount=${encodeURIComponent(amount)}`;
    });
  </script>
</body>
</html>
