<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jamaica We Rise â€” Backend Test</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f5f5f5;
      color: #222;
      padding: 40px;
      line-height: 1.5;
    }
    h1 {
      color: #1a5f3f;
      text-align: center;
    }
    button {
      display: block;
      margin: 20px auto;
      padding: 12px 24px;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: #1a5f3f;
      color: white;
    }
    pre {
      background: #222;
      color: #0f0;
      padding: 20px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <h1>ðŸ§© Jamaica We Rise â€” Backend Test</h1>
  <p>Click each test to verify live backend endpoints.</p>

  <button onclick="testCheckout()">Test: /create-checkout-session</button>
  <button onclick="testVerifySoulmark()">Test: /verify-soulmark (no session)</button>
  <button onclick="testRegister()">Test: /register (mock data)</button>
  <button onclick="testUsername()">Test: /check-username/adriantrufit</button>

  <pre id="output">Awaiting test results...</pre>

  <script type="module">
    let CONFIG={BACKEND_URL:"https://jamaica-we-rise.onrender.com"};
    try {
      const imported = await import("./config.js");
      if(imported?.CONFIG) CONFIG = imported.CONFIG;
    } catch(e) {
      console.warn("âš ï¸ config.js not found, using fallback:", CONFIG);
    }

    const BACKEND_URL = CONFIG.BACKEND_URL;
    const output = document.getElementById("output");

    async function runTest(name, fn) {
      output.textContent = `â³ Running ${name}...`;
      try {
        const result = await fn();
        output.textContent = `âœ… ${name} result:\n\n` + JSON.stringify(result, null, 2);
      } catch (err) {
        output.textContent = `âŒ ${name} failed:\n\n` + err;
      }
    }

    async function testCheckout() {
      runTest("/create-checkout-session", async () => {
        const res = await fetch(`${BACKEND_URL}/create-checkout-session`, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ amount: 5, email: "test@example.com", name: "Test Donor" })
        });
        return res.json();
      });
    }

    async function testVerifySoulmark() {
      runTest("/verify-soulmark", async () => {
        const res = await fetch(`${BACKEND_URL}/verify-soulmark?session_id=fake_test_id`);
        return res.json();
      });
    }

    async function testRegister() {
      runTest("/register", async () => {
        const res = await fetch(`${BACKEND_URL}/register`, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({
            role: "donor",
            name: "Backend Test",
            email: "backend@test.com",
            username: "backendtest",
            soulmark: "SM_TEST_FAKE_123"
          })
        });
        return res.json();
      });
    }

    async function testUsername() {
      runTest("/check-username/adriantrufit", async () => {
        const res = await fetch(`${BACKEND_URL}/check-username/adriantrufit`);
        return res.json();
      });
    }
  </script>
</body>
</html>
